# 🤔 DNS와 DHCP



## 🧐 도메인

> 인터넷에 연결된 컴퓨터를 사람이 쉽게 기억하고 입력할 수 있도록 문자로 만든 인터넷 주소

### 1. IP와 도메인?

인터넷에 연결되어 있는 장치들은 각각의 장치를 식별할 수 있는 주소를 가지고 있는데 이를 ip라고 한다.

ip는 숫자로 구성되어 있다. ex) naver => 220.95.233.172, daum => 114.108.157.19

이렇게 불규칙적인 숫자로 이루어져있기 때문에 일일히 이해하고 기억하기가 매우 어렵다.

이를 해결하기 위해 각 ip에 이름을 부여할 수 있게 했는데, 이것을 **`도메인`**이라고 한다.



### 2. 도메인의 구성요소

✨ **opentutorials.org**

- opentutorials: 컴퓨터의 이름
- org: 최상위 도메인 - 비영리단체

✨ **daum.co.kr**

- daum: 컴퓨터의 이름
- co: 국가 형태의 최상위 도메인을 의미
- kr: 대한민국의 NIC에서 관리하는 도메인을 의미





## 🧐 DNS

### 1. Domain Name System

사람이 IP주소를 이해하고 활용하고자 하지만 불규칙적인 숫자를 모두 외운다는건 굉장히 힘든 일이다.

결국에는 특정 서버에서 도메인값을 IP주소로 반호나해주는 역할을 해야하며 이러한 작업을 하는 것이 바로 **`DNS서버`**이다. 이 DNS는 브라우저가 인터넷 자원을 로드할 수 있도록 도메인 이름을 IP주소로 변환한다.

즉, DNS란 특정 노드의 주소를 찾기 위해 사람이 이해하기 쉬운 도메인 이름을 IP주소로 변환해주는 역할을 한다. 

그리고 이 안에서 부분적으로 자기 자신의 역할을 하는 서버를 DNS 서버라고 한다.

(2017년 말 기준 도메인 이름의 수는 3억 3,200만개 이상)



### 2. DNS 구조와 작동 방식

#### 📗 구조

인터넷에서 사용되는 도메인은 전 세계적으로 고유하게 존재하는 이름이다.

정해진 규칙 및 체계에 따라야 하며, 임의로 변경되거나 생성될 수는 없다.

인터넷상의 모든 도메인은 ".(dot)" 또는 루트(root)라 불리는 도메인 아래에 그림과 같이 나무를 거꾸로 위치시킨 역트리구조로 계층적으로 구성되어있다.

![](./image/68.png)



DNS 구조는 다음과 같이 Root, Top-Level, Second-Level, Sub의 위계구조를 갖는다.

루트 도메인 바로 아래의 단계를 1단계 도메인 또는 최상위 도메인(TLD, Top Level Domain)이라고 부르며, 그 다음 단계를 2단계 도메인(SLD, Second Level Doamin)이라고 한다.

해당 부분을 담당하는 컴퓨터(DNS서버)가 각각 존재하며, DNS 서버는 Root에서 시작해서 Sub로 거슬러 올라가며 IP를 탐색한다.

도메인은 일반최상위도메인(gTLD)과 국가최상위도메인(ccTLD)로 구분할 수 있다.

![](./image/67.png)

초창기 인터넷에서는 1대의 DNS 서버만으로도 충분히 IP주소와 이름의 관리가 가능했지만, 인터넷이 폭발적으로 확장되면서, 몇 대의 DNS 서버로는 실시간으로 인터넷 상의 수많은 컴퓨터들을 관리할 수가 없게 되었다.

그래서 위와 같은 트리 구조의 '도메인 이름 체계'가 나온 것이다.



#### 📗 DNS 서비스 유형

✨ **신뢰할 수 있는 DNS**

- 퍼블릭 DNS 이름을 관리하는 데 사용하는 업데이트 메커니즘을 제공하며, 이를 통해 DNS 쿼리에 응답하여 도메인 이름을 IP주소로 변환한다.
- 신뢰할 수 있는 DNS는 도메인에 대해 최종 권한이 있으며 재귀적 DNS서버에 IP주소 정보가 담긴 답을 제공할 책임이 있다.

✨ **재귀적 DNS**

- 보통 클라이언트는 신뢰할 수 있는 DNS 서비스에 직접 쿼리를 수행하지 않고, 해석기 또는 재귀적 DNS 서비스라고 알려진 다른 유형의 DNS 서비스에 연결하는 경우가 일반적이다.
- 일정 기간 동안 캐시된 또는 저장된 DNS 레퍼런스를 가지고 있는 경우, 소스 또는 IP 정보를 제공하여 DNS쿼리에 답을 하거나, 해당 정보를 찾기 위해 쿼리를 하나 이상의 신뢰할 수 있는 DNS 서버에 전달한다.



#### 📗 DNS 서버 종류 구분

도메인의 수가 너무 많기 때문에, DNS 서버 종류를 계층화해서 단계적으로 처리한다.

특히 도메인의 총 관리는 ICANN에서 하기 때문에, DNS 서버도 최상위 도메인에서 개인 도메인의 서브 도메인까지 도메인 이름의 분류와 마찬가지로 디렉토리/계층 형태로 구분된다.

![](./image/75.png)

- Root DNS Server: ICANN이 직접 관리하는 절대 서버로, TLD DNS 서버 IP들을 저장해두고 안내하는 역할
- TLD(최상위 도메인) DNS Server: 도메인 등록기관(Registry)이 관리하는 서버로, Authoritative DNS서버 주소를 저장해두고 안내하는 역할을 한다. 어떤 도메인 묶음이 어떤 Authoritative DNS Server에 속하는지 아는 이유는 도메인 판매 업체(Registrar)의 DNS설정이 변경되면 도메인 등록 기관(Registry)으로 전달되기 때문이다.
- Authoritative DNS Server: 실제 개인 도메인과 IP 주소의 관계가 기록/저장/변경되는 서버이다. 그래서 권한의 의미인 Authoritative가 붙은 것이다. 일반적으로 도메인/호스팅 업체의 '네임서버'를 말하지만, 개인 DNS 서버 구축을 한 경우에도 여기에 해당한다.
- Recursive DNS Server: 인터넷 사용자가 가장 먼저 접근하는 DNS 서버이다. 위 3개의 DNS 서버를 매번 거친다면 효율이 낮을 수 밖에 없으니, 한 번 거친 후 얻은 데이터를 일정기간 동안 **캐시**라는 형태로 저장해 두는 서버이다. 직접 도메인과 IP 주소의 관계를 기록/저장/변경하지는 않고 캐시만을 보관하기 때문에, Authoritative와 비교되는 의미로 반복의 Recursive가 붙는다. 대표적으로 KT/LG/SK와 같은 ISP(통신사) DNS 서버가 있고, 브라우저 우회 용도로 많이 쓰는 구글 DNS 등이 있다.



#### 📗 작동 원리

DNS서버는 **IP 주소를 특정 도메인 주소와 같다는 기록을 저장**해두고, 인터넷 사용자들이 도메인 주소를 검색했을 때 IP 주소로 연결되도록 해준다.

브라우저가 URL에 적힌 값을 파싱해서 HTTP Request Message를 만들고 전송 요청을 하게 되는데, 이 때 IP주소가 아닌 Domain만으로는 요청을 보낼 수가 없기 때문에 **`DNS Lookup`**을 수행한다.

- Recursive Query: Local DNS 서버가 여러 DNS 서버를 차례대로 (Root DNS 서버 => com DNS 서버 => naver.com DNS 서버)질의해서 답을 찾아가는 과정
- ![](./image/74.png)

- **DNS 동작 과정**

  ​	![](%F0%9F%A4%94%20DNS%EC%99%80%20DHCP.assets/73.png)

  - **1단계: Local Hosts 파일 참조**
    (hosts 파일을 이용한 네트워크 접속은 윈도우 같은 경우 `C:\Windows\System32\drivers\etc\hosts`파일에 URL과 IP주소를 기록해 놓는 방식 사용)

    ![](./image/69.png)

    ![](./image/72.png)

    > (여기에 IP와 도메인을 추가해서 사용할 수 있다. 만약 3단계에서 DNS서버를 엉뚱하게 해놓고 여기에 옳바른 IP주소와 도메인을 메모해놓으면 제대로 잘 찾아간다. 만약 잘못 적어놓으면 해당 사이트를 못찾아 가는데, 결국 컴퓨터는 알고 찾아가는 것이 아니라 적혀있는데로 찾아가는 것이다.)

  - **2단계: 자체의 DNS cache table**

  - **3단계: DNS Server 참조**
    (최상위인 Root Domain으로 보낸 후 Top-Level Domain, Second-Level Domain 서버 검색, Sub 서버 검색 순으로 이름에 해당하는 IP를 찾게된다.)
    (방대한 양의 도메인 주소를 정리해 놓은 전화번호부 같은 것이다. DNS 서버는 인터넷에서 변화하는 모든 컴퓨터의 URL과 IP정보를 거의 실시간으로 제공하므로, 사용자는 더 이상 URL에 해당하는 IP 주소를 신경 쓸 필요가 없다.)

    ![](./image/70.png)

    > (이렇게 DNS 서버를 통해 네이버의 IP주소를 얻어낼 수 있다.)

    ![](./image/71.png)

    > (제어판 > 네트워크 및 인터넷 > 네트워크 및 공유 센터 > 연결: (나의 경우)Wi-Fi(NEXT_8004N) > 속성 > 인터넷 프로토콜 버전 4(TCP/IPv4) > 속성)
    > (여기서 보면 자동으로 DNS 서버 주소 받기를 통해 DNS서버를 이용하고 있다는 것을 알 수 있다. 만일 여기서 DNS 서버를 다른 것으로 해놓고 브라우저에 도메인을 적어보면 해당 사이트를 찾아가질 못한다.)

- 예시
  - 웹 브라우저에 www.naver.com을 입력하면 먼저 Local DNS에게 IP주소를 질의하여 Local DNS에 없으면 다른 DNS name 서버 정보를 받음(Root DNS 정보 전달 받음)
  - Root DNS 서버에 www.naver.com 질의
  - Root DNS 서버로부터 com도메인을 관리하는 TLD(Top-Level Domain)이름 서버 정보 전달 받음
  - TLD에 www.naver.com 질의
  - TLD에서 name.com 관리하는 DNS 정보 전달
  - naver.com 도메인을 관리하는 DNS서버에 www.naver.com 호스트네임에 대한 IP 주소 질의
  - Local DNS 서버에게 www.naver.com에 대한 IP주소 222.122.195.6 응답
  - Local DNS는 www.naver.com에 대한 IP주소를 캐싱을 하고 IP 주소 정보 전달





## 🧐 DHCP

> Dynamic Host Configuration Protocol은 네트워크 조직의 호스트에게 동적으로 IP를 할당하는 프로토콜이다.



### 1. DHCP?