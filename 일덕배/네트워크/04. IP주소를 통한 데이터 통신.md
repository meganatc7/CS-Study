# 🤔 IP주소를 통한 데이터 통신

> TCP/IP프로토콜을 사용하는 모든 장비를 구분해주기 위해 만들어낸 주소이며
>
> 실제 컴퓨터끼리는 IP주소를 사용하여 데이터를 통신한다.



## 🧐 3계층의 기능(네트워크 계층)

> 2계층의 주소체계: MAC주소(물리주소)
>
> 3계층의 주소체계: IP주소



#### 1. 3계층의 기능

3계층은 다른 네트워크 대역 즉, 멀리 떨어진 곳에 존재하는 네트워크까지 어떻게 데이터를 전달할지 제어를 담당한다.

발신에서 착신까지 패킷의 경로를 제어한다.

대표적인 장비로 **`라우터`**가 있다.

![image](https://user-images.githubusercontent.com/70757883/126867813-fd2c8918-b0f1-4bdb-bcda-a85b5bc5386b.png)

LAN과 LAN 이렇게 서로 다른 네트워크 영역을 연결하기 위해서는 3계층 장비 라우터가  필요하다.



#### 2. 3계층에서 사용하는 주소

WAN에서 통신할 때 IP주소를 사용한다.

3계층 프로토콜로는 **ARP**, **IPv4**, **ICMP**가 있다.



## 🧐 IP주소

> IP주소는 필드로 나누어져 있는데 한 필드당 1byte의 크기를 갖는다.
>
> 예를들어, 192.168.0.189이면 192/168/0/189가 각각의 필드이고, 1byte로 0~255중의 십진수로 표기한다.



#### 1. Classful IP주소(초창기)

처음 IP주소가 등장했을 땐, 클래스에 맞게 정의하고 사용하였다.

![image](https://user-images.githubusercontent.com/70757883/126867931-49c86192-3001-42fe-b501-7c48cd2d8820.png)

필드를 통해 (xxx.xxx.xxx 세번째 까지) 네트워크 대역을 구분하고, 나머지로 그 대역에 있는 PC들을 구분한다.

하지만, 네트워크 구분을 하고 나머지로 PC를 구분하는데 예를 들어 PC가 30대밖에 없으면 많은 IP주소를 낭비하는 꼴이 되어버린다. (xxx.xxx.xxx.000~xxx.xxx.xxx.255 중에 30개 밖에 사용 못하는 꼴!)



#### 2. Classless IP주소

위에서 알아본 바와 같이 classful한 주소체계는 낭비가 존재한다.



##### ✨서브넷 마스크: 네트워크 대역을 보조하는 역할을 한다. 즉, 네트워크 대역을 어디서부터 구분할 것인지 지정한 것이다.

- classful한 네트워크 대역을 나눠주는데 사용하는 값
- 어디까지가 네트워크 대역을 구분하는데 사용하고 어디서부터 호스트를 구분하는데 사용하는지 지정해줌
- 2진수로 표기했을 때 1로 시작, 1과 1 사이에는 0이 올 수없다는 규칙이 존재한다(0이 한번 나오면 그 뒤는 전부 0). 그래서 1과 0이 구분되는 곳을 기점으로 네트워크 대역과 호스트를 구분하는 파티션이 된다.
  - ex) 255.255.255.192 -> 11111111.11111111.11111111.11000000
  - 마지막 1까지는 네트워크 대역 구분, 나머지 0은 호스트 구분

이렇게 서브넷 마스크를 사용하여 classful한 주소체계의 문제점을 어느정도 해결했다.



#### 3. 사설 IP와 공인 IP

> 현재 사용하고 있는 IPv4 개념, classless와 같이 사용

![image](https://user-images.githubusercontent.com/70757883/126868222-b74cc2b0-4a81-467e-9d06-c9627368b09e.png)

##### ✨ 공인IP: 인터넷 세상에서 실제 네트워크 통신망에서 통신을 할 때 사용하는 IP주소

##### ✨ 사설IP: 같은 네트워크 대역에서 사용하는 IP주소

사설IP와 외부 세상이 통신할 때는 공인 IP주소로 바꾸어서 통신을 한다.

쉽게 말해서 집에서 모든 전자기기는 하나의 공유기를 통해 바깥 인터넷에 접속하는 모양이다.



![image](https://user-images.githubusercontent.com/70757883/126868258-85063aa3-1d8f-48c9-a73e-673ac882fd60.png)

> 위에 있는 것이 공인IP
>
> 아래 있는 것이 사설IP

그래서, 외부에서 볼 때는 개별 pc 하나하나의 주소가 구분되지 않는다.

다만 공유기에 할당된 IP를 알고 그 공유기에서 사설IP로 보내주는 것이다.

즉, 요청은 공유기를 거쳐 공이IP로 바뀌어 밖으로 나가고 요청은 공유기에 들어와서 아까 요청했던 사설IP에게 요청을 전달해주는 흐름이다.

이렇게 사설IP를 공인IP로 바꿔주는 것을 NAT(Network Address Translation)라고 한다.

##### ✨흐름

- 공유기는 나갈 때 어떤 요청을 보냈는지 기록을 한다.
- 내부에서 바깥 WAN대역으로 나갈때 기록을 한다.
- NAT 테이블이란 곳에 기록을 하고 그것에 대한 응답이 왔을 때 NAT 테이블을 보고 대상에게 전달해준다.
  - 만일, 나간적이 없는 패킷이 응답으로 공유기에 들어온다면
  - 내부의 특정 기기한테 보내지 않고 그냥 공유기 선에서 받고 끝난다.
  - 예를 들어 서버는 요청을 받는 입장인데, 나간 기록이 없으면 응답을 해줄 수가 없다.
  - 그래서 일반적으로 서버는 공인IP를 사용하거나 공유기에 특별한 설정(포트포워딩)을 한다.



![image](https://user-images.githubusercontent.com/70757883/126868357-bd30f9ee-4e7a-445d-9756-c43fa60afcc8.png)

> 실제 인터넷 세상에서는 공인 IP로만 통신하며, 외부 네트워크 대역에서는 사설IP대역이 보이지 않는다.

특이한 것은 외부에서 볼 땐 사설 네트워크 대역이 없는 것 처럼 보인다.
(위 사진처럼 공유기만 존재하는 것으로 보여진다.)

외부 입장에선 한 주택(공간)이 공유기 하나로 보이며, 실제 인터넷 세상에선 공인IP로만 통신한다.



결론적으로, 공인IP 하나 당 사설의 네트워크 대역이 따로 생긴 것이기 때문에, IP주소 하나당 0~255.255.255.255까지가 생겨서 IP주소 부족현상은 해결된 셈이다.

이후 부족현상은 IPv6로 해결하는데 이 부분은 다음에 다뤄보도록 하자.



*기타

공유기 구멍을 보면 하나는 WAN인데 이것이 바로 외부에서 들어오는 인터넷 선을 말한다.
나머지는 사설 네트워크 대역에서 쓰는 선들을 꽂는 구멍이며, WAN에서는 공인IP가 할당되고,
나머지 구멍이 사설IP를 할당받는 것이다.



## 🧐 특수한 IP주소



#### 1. 게이트웨이 주소

> 어딘가로 가려면 일단 여기로, 게이트웨이 주소!!

![image](https://user-images.githubusercontent.com/70757883/126868824-b95333f7-bd8d-4e79-928c-541a28df3ad3.png)

##### ✨역할

현재 사용자가 위치한 네트워크에서 다른 네트워크로 이동하기 위해 반드시 거쳐야 하는 거점이다.

두 컴퓨터(노드)가 네트워크 상에서 서로 연결되려면 동일한 프로토콜을 사용해야 한다.

따라서, 프로토콜이 서로 다른 네트워크 상의 컴퓨터와 통신하려면 두 프로토콜을 적절히 변환해주는 변환기가 필요한데 그것이 `게이트웨이`가 그런 역할을 해준다.

즉, 서로 다른 네트워크로 이동하기 위한 관문이다.



![image](https://user-images.githubusercontent.com/70757883/126868895-f8e6b839-64fd-458c-a74f-b2e5199c9566.png)

일반적으로 로컬 네트워크 구역 내에서는 IP주소와 서브넷 마스크만 있어도 주변 컴퓨터와 통신이 가능하다.(다른 네트워크 구역으로 나갈 필요가 없기 때문!)

하지만, 인터넷 등의 이기종 네트워크로 나가기 위해서는 게이트웨이가 이썽야 하고, IP주소, 서브넷 마스크와 함께 게이트웨이 주소까지 정확하게 설정해야 한다.



![image](https://user-images.githubusercontent.com/70757883/126868584-122928ed-df4a-4b8d-8d40-2ce682a86a39.png)

컴퓨터가 서로 통신하기 위해 모든 컴퓨터마다 유일한 IP주소를 할당해야 하듯, 게이트웨이도 중복되지 않는 IP주소가 필요하다.

이 IP주소를 토대로 각 컴퓨터가 다른 네트워크와 연결되는 것이다.

기본 게이트웨이에는 현재 네트워크 대역에서 쓸 수 있는 가장 작거나 가장 큰 IP를 적는다.
(일반적으로 1로 지정)

##### 결국, 기본적으로 저 세개의 IP가 설정되어야 인터넷이라는 것이 되는 것이다.

