# 06 라우팅 

3계층의 대표적인 역할이 해당 프로토콜로 최적의 경로를 통해 가도록 하는 것인데, 그러한 정보를 담고 있는 지도테이블이 바로 라우팅 테이블이다.

라우팅 테이블이 무엇이고, 어떤 방식으로 동작하는지 알아보자.



## 🛑 라우팅 테이블

cmd창을 열어서 `netstat -r` 명령어를 입력하면 라우팅 테이블을 볼 수 있다.

![라우팅 테이블](img/%EB%9D%BC%EC%9A%B0%ED%8C%85%20%ED%85%8C%EC%9D%B4%EB%B8%94.PNG)

이곳에 적힌 주소로만 이동할 수 있고, 어디로 가야할 지 모르는 경우 게이트웨이로 빠져나가도록 설정되어있다.



### 🛑 다른 네트워크랑 통신하는 과정

- 목적지의 네트워크 대역이 본인의 라우팅 테이블에 존재해야지만 통신할 수 있다.

  ![라우팅1](img/%EB%9D%BC%EC%9A%B0%ED%8C%851.PNG)



- ICMP 요청 프로토콜 만든다. (type: 8(요청)) -> IPv4 프로토콜 생성 -> 이더넷 프로토콜 생성

  ![라우팅2](img/%EB%9D%BC%EC%9A%B0%ED%8C%852.png)

  ![라우팅3](img/%EB%9D%BC%EC%9A%B0%ED%8C%853.png)

  

- 이더넷 프로토콜의 목적지 MAC주소는 실제 목적지의 MAC주소가 아닌, 가는 경로 중 가장 가까운게이트웨이의 MAC주소로 담긴다.

  ![라우팅4](img/%EB%9D%BC%EC%9A%B0%ED%8C%854.png)

- 패킷을 받은 게이트웨이에서 IPv4를 확인 후 목적지 주소가 맞는지 확인한다. -> 라우팅 테이블을 확인하여서 어디로 가야하는지를 확인한다. -> 이더넷 프로토콜을 다시 만든다. (출발지, 목적지 MAC주소 변경)

  ![라우팅5](img/%EB%9D%BC%EC%9A%B0%ED%8C%855.png)

  ![라우팅6](img/%EB%9D%BC%EC%9A%B0%ED%8C%856.png)

- 목적지에 도착하면 ICMP 응답 프로토콜을 만든 뒤 같은 방식으로 다시 출발지로 돌아가서 응답을 보내준다.

  ![라우팅7](img/%EB%9D%BC%EC%9A%B0%ED%8C%857.png)