# 07. IPv4의 조각화

### 🤔조각화란?

큰 IP 패킷들이 적은 MTU를 갖는 링크를 통해서 전송되려면, 여러개의 작은 패킷으로 조각화되어 전송돼야 한다. -> 목적지까지 패킷을 전달하는 과정에 통과하는 각 라우터마다 전송에 적합한 프레임으로 변환이 필요하다.

**조각화가 되면, 최종 목적지에 도달할 때 까지 재조립되지 않는 것이 일반적이다.**

> MTU(Maximum Transmission Unit): 데이터 최대 전송 단위



### 🙄조각화 되는 과정

IPv4가 `20 bytes`, 데이터가 `11980 bytes`인 패킷을 보내려고 하는데 MTU가 `3300 byte`인 상황

->  MTU에 맞춰서 데이터를 잘게 쪼개야 한다.

->  MTU는 `IPv4 프로토콜 길이까지 합친 값`

-> 한번에 3300 - 20(IPv4) = 3280 크기로 쪼갠다.

-> `3280 + 3280 + 3280 + 2140`

![패킷1](img/%ED%8C%A8%ED%82%B71.png)

![패킷2](img/%ED%8C%A8%ED%82%B72.png)



- MF: 뒤에 패킷의 존재 유무를 알려줌( 1: 존재, 2: 존재X)

- offset: 첫 번째 데이터로부터 얼마나 떨어져있는지 위치를 알려줌.

  데이터 크기만큼 떨어져있음(8로 나눈 값이 들어감 => 3280 / 8)

- 4개의 패킷의 `identification`, 즉 id값은 동일하게 설정됨

  ![패킷3](img/%ED%8C%A8%ED%82%B73.png)



### 🤗 One More Time!

MTU가 1500인데 데이터가 그 이상인 경우 조각화를 하게 된다.

![패킷4](img/%ED%8C%A8%ED%82%B74.png)



MTU가 걸러지는 시점은 이더넷이 붙기 전이기 때문에

나중에 이더넷이 붙으면서 패킷의 길이가 1514가 된다.

![패킷5](img/%ED%8C%A8%ED%82%B75.png)

결과적으로

- 패킷 길이

  ![패킷6](img/%ED%8C%A8%ED%82%B76.png)

- ID

  ![패킷7](img/%ED%8C%A8%ED%82%B77.png)

- More Fragment

  ![패킷8](img/%ED%8C%A8%ED%82%B78.png)

  첫 번째 패킷의 값이 2인 이유: 0000 0000 0000 0000 중 왼쪽부터 3비트 `000` 부분이 포함되어 있는데, 그중 3번째의 비트가 남아있는 것의 개수를 뜻한다.

  따라서 0010 0000 0000 0000이 되고, 앞에 4비트의 값이 2가 된다.

- 패킷 순서

  ![패킷9](img/%ED%8C%A8%ED%82%B79.png)

  패킷의 위치를 뜻한다. 두 번째 값이 0 b9 인 이유는 1480(1500-20) / 8 인 값(16진수)이 들어가기 때문이다.

​	